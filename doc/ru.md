# Документация Indb.js

Добро пожаловать в документацию проекта Indb.js.

---

## `await init(database, version, tables)`

Метод `init` открывает соединение с базой данных (или создает её). Принимает три обязательных аргумента:

- **database** — имя базы данных (строка).
- **version** — номер версии (число).
- **tables** — JSON-объект со схемой таблиц.

### Пример объекта таблиц

```javascript
const tables = {
    songs: { // Имя таблицы (ObjectStore)
        increment: "id", // Поле, которое будет авто-инкрементируемым первичным ключом
        indexes: { // Индексы для таблицы songs
            title: {
                name: "title",
                unique: false,
                multiEntry: false
            }
        }
    }
    // ...другие таблицы
};
```

### Пример инициализации

```javascript
const indb = new Indb();
await indb.init("mydb", 1, tables);
```

### Примечание

В описании индексов поле `name` можно не указывать, если имя индекса совпадает с именем поля в базе. Указывайте его только если хотите задать индексу имя, отличное от поля таблицы.

---

## `await importData(json, overwrite = false)`

Метод `importData` позволяет импортировать данные из JSON-объекта в базу данных.

- **json** — объект с данными. **Внимание!** Это должен быть JavaScript-объект, а не JSON-строка. Обязательный аргумент.
- **overwrite** — булево значение.
    - `true`: полностью перезаписать таблицу (старые данные удаляются).
    - `false`: (по умолчанию) добавить новые данные к существующим.

### Пример структуры данных

```javascript
const jsonData = {
    songs: [ // Массив записей для таблицы 'songs'
        {
            title: "song1",
            path: "[https://mysong.local/file1.mp3](https://mysong.local/file1.mp3)"
        },
        {
            title: "Song2",
            path: "[https://mysong.local/file2.mp3](https://mysong.local/file2.mp3)"
        }
    ]
    // ...данные для других таблиц
};
```

### Использование

```javascript
await indb.importData(jsonData); // Добавляем новые записи к старым
await indb.importData(jsonData, true); // Очищаем таблицы и записываем только новые данные
```

---

## `await exportData()`

Метод позволяет экспортировать все данные из базы в виде объекта.

### Пример

```javascript
const data = await indb.exportData();
console.log(data);
```

---

## `await drop(database)`

Метод удаляет указанную базу данных из браузера.

**Внимание!** Для успешного удаления необходимо закрыть все вкладки с этим сайтом, кроме той, в которой выполняется удаление. Это требование спецификации IndexedDB (событие `onblocked`).

### Пример

```javascript
await indb.drop("mydb"); // вернёт true в случае успеха
```

---

## `await add(table, data)`

Метод добавляет одну запись или массив записей в таблицу. Поле авто-инкремента указывать не нужно, база назначит его сама.

### Пример

```javascript
// Одна запись
await indb.add("songs", {
    title: "song3",
    path: "[https://mysongs.local/file3.mp3](https://mysongs.local/file3.mp3)"
});

// Несколько записей
await indb.add("songs", [
    { title: "song4", path: "..." },
    { title: "song5", path: "..." }
]);
```

---

## `await put(table, data)`

Метод обновляет запись в таблице или создает новую, если ключа нет. Также принимает массив объектов или один объект.

**Важно:** Метод полностью перезаписывает объект. Если вы передадите объект не целиком (без некоторых полей), старые поля будут утеряны.

### Пример

```javascript
await indb.put("songs", {
    id: 1, // Обязательно указываем ID для обновления
    title: "songs34",
    path: "[https://mysongs.local/file3.mp3](https://mysongs.local/file3.mp3)"
});
// С массивом объектов так же как в add, только не забываем указывать id.
```

### Примечание

Если вы не передадите поле с первичным ключом (например, `id`), метод сработает как `add` — добавит новую запись вместо обновления старой.

---

## `await delete(table, id)`

Метод удаляет одну запись из таблицы по её ключу (ID).

### Пример

```javascript
await indb.delete("songs", 3);
```

---

## `await deleteMany(table, ids)`

Метод удаляет несколько записей по списку их ID.

### Пример

```javascript
await indb.deleteMany("songs", [1, 2, 3]);
```

---

## `await update(table, id, data)`

Метод позволяет изменить конкретные поля в существующей записи, не перезаписывая объект целиком.

### Пример

```javascript
await indb.update("songs", 3, { title: "song321" });
```

---

## `await clear(table)`

Метод полностью очищает указанную таблицу (удаляет все записи).

### Пример

```javascript
await indb.clear("songs");
```

---

## `await get(table, id)`

Метод получает одну запись из таблицы по её ID.

### Пример

```javascript
let data = await indb.get("songs", 1);
console.log(data); 
// Результат: {title: "song1", path: "[https://mysongs.local/file1.mp3](https://mysongs.local/file1.mp3)", id: 1}
```

---

## `await findBy(table, index, value)`

Метод находит **первую** попавшуюся запись, соответствующую критериям поиска (индекс + значение).

### Пример

```javascript
let data = await indb.findBy("songs", "title", "song1");
```

---

## `await findAll(table, index, value)`

Метод получает массив всех записей, соответствующих критериям поиска.

### Пример

```javascript
// Вернёт массив всех песен, где title === "song1"
let data = await indb.findAll("songs", "title", "song1"); 
```

---

## `await getAll(table)`

Метод возвращает вообще все записи из указанной таблицы.

### Пример

```javascript
let data = await indb.getAll("songs");
```

---

## `tokens(string)`

Вспомогательный метод. Превращает строку в массив слов (токенов). Он удаляет знаки препинания, оставляя только буквы и цифры. Это полезно для создания поисковых индексов с параметром `multiEntry: true`.

### Пример

```javascript
let a = indb.tokens("hello, world!");
console.log(a); // ["hello", "world"]
```

---

## `await search(table, index, value, op = "and")`

Метод выполняет полнотекстовый поиск по таблице (используя токенизацию).
В качестве `value` передается строка слов.

Метод принимает необязательный четвертый параметр `op` (логика поиска):
- `"and"` (по умолчанию): запись должна содержать **все** слова из запроса (пересечение).
- `"or"`: запись должна содержать **хотя бы одно** слово из запроса (объединение).

### Пример

```javascript
// Найдёт только записи, где есть И "My", И "super", И "song"
let strictSearch = await indb.search("songs", "title", "My super song", "and"); 

// Найдёт все записи, где встречается любое из этих слов
let broadSearch = await indb.search("songs", "title", "rock metal", "or");
```

**Примечание:** Внутри метода выполняется автоматическая токенизация строки запроса. Разработчику не нужно вызывать `tokens()` вручную. Если вам нужны точные совпадения по целой фразе (без разбивки на слова), лучше использовать `findBy` или `findAll`.

---

## `await select(obj)`

Универсальный метод для выборки данных с поддержкой пагинации и сортировки (использует курсоры). Принимает объект параметров:

- **table** — Имя таблицы (обязательно).
- **index** — Имя индекса (необязательно, если поиск идет не по первичному ключу).
- **value** — Значение для поиска (применяется только вместе с index).
- **offset** — Сколько записей пропустить (смещение).
- **limit** — Сколько записей вернуть.
- **direction** — Направление сортировки (`next` или `prev`).

Параметр `value` может быть строкой или диапазоном (объектом IDBKeyRange).

**Пример диапазонов:**
```javascript
{
    value: "hello" // Точное совпадение
}
// или
{
    value: { start: 1, end: 5 } // Диапазон: например, от 1 до 5 лет
}
```

### Пример запроса

```javascript
let querySelect = await indb.select({
    table: "users",
    index: "shop",      // Ищем по индексу магазина
    value: "Kaufland",  // Значение: Kaufland
    offset: 10,         // Пропустить первые 10 найденных
    limit: 10,          // Вернуть следующие 10
    direction: "prev"   // Сортировка в обратном порядке
});
```

---

## `await remove(obj)`

Метод массового удаления записей. Принимает такой же объект параметров, как и `select` (позволяет удалить диапазон данных или данные по фильтру).

---

## `await count(obj)`

Метод возвращает количество записей, соответствующих запросу. Объект параметров идентичен методу `select`.